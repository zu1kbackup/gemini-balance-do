# Gemini API è´Ÿè½½å‡è¡¡å™¨ (gemini-balance-do)

è¿™æ˜¯ä¸€ä¸ªéƒ¨ç½²åœ¨ Cloudflare Workers ä¸Šçš„ Gemini API è´Ÿè½½å‡è¡¡å™¨å’Œä»£ç†æœåŠ¡ï¼Œä½¿ç”¨äº† Durable Objects æ¥å­˜å‚¨å’Œç®¡ç† API å¯†é’¥ã€‚

å®ƒæ—¨åœ¨è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š
*   å°†å¤šä¸ª Gemini API å¯†é’¥èšåˆåˆ°ä¸€ä¸ªç«¯ç‚¹ä¸­ã€‚
*   é€šè¿‡éšæœºè½®è¯¢å¯†é’¥æ± æ¥å®ç°è¯·æ±‚çš„è´Ÿè½½å‡è¡¡ã€‚
*   æä¾›ä¸ OpenAI API å…¼å®¹çš„æ¥å£ï¼Œä½¿ç°æœ‰å·¥å…·å¯ä»¥è½»æ¾é›†æˆã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

*   **Gemini API ä»£ç†**: ä½œä¸º Google Gemini API çš„ç¨³å®šä»£ç†ã€‚
*   **è´Ÿè½½å‡è¡¡**: åœ¨é…ç½®çš„å¤šä¸ª API å¯†é’¥ä¹‹é—´éšæœºåˆ†é…è¯·æ±‚ã€‚
*   **OpenAI API æ ¼å¼å…¼å®¹**: æ”¯æŒ `/v1/chat/completions`, `/v1/embeddings` å’Œ `/v1/models` ç­‰å¸¸ç”¨ OpenAI ç«¯ç‚¹ã€‚
*   **æµå¼å“åº”**: å®Œå…¨æ”¯æŒ Gemini API çš„æµå¼å“åº”ã€‚
*   **API å¯†é’¥ç®¡ç†**:
    *   æä¾›ä¸€ä¸ªç®€å•çš„ Web UI ç”¨äºæ‰¹é‡æ·»åŠ å’ŒæŸ¥çœ‹ API å¯†é’¥ã€‚
    *   æä¾› API æ¥å£ç”¨äºæ£€æŸ¥å¹¶è‡ªåŠ¨æ¸…ç†å¤±æ•ˆçš„å¯†é’¥ã€‚
*   **æŒä¹…åŒ–å­˜å‚¨**: ä½¿ç”¨ Cloudflare Durable Objects å†…çš„ SQLite å®‰å…¨åœ°å­˜å‚¨ API å¯†é’¥ã€‚

## ğŸš€ éƒ¨ç½²

ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å°†æ­¤é¡¹ç›®éƒ¨ç½²åˆ°ä½ è‡ªå·±çš„ Cloudflare è´¦æˆ·ï¼š

### æ–¹æ³•ä¸€ï¼šé€šè¿‡ Wrangler CLI éƒ¨ç½²

1.  **å…‹éš†é¡¹ç›®**
    ```bash
    git clone https://github.com/zaunist/gemini-balance-do.git
    cd gemini-balance-do
    ```

2.  **å®‰è£…ä¾èµ–**
    ```bash
    pnpm install
    ```

3.  **ç™»å½• Wrangler**
    ```bash
    npx wrangler login
    ```

4.  **éƒ¨ç½²åˆ° Cloudflare**
    ```bash
    pnpm run deploy
    ```
    éƒ¨ç½²æˆåŠŸåï¼ŒWrangler ä¼šè¾“å‡ºä½ çš„ Worker URLã€‚

### æ–¹æ³•äºŒï¼šé€šè¿‡ Cloudflare Dashboard éƒ¨ç½² (æ¨è)

1.  **Fork é¡¹ç›®**: ç‚¹å‡»æœ¬ä»“åº“å³ä¸Šè§’çš„ "Fork" æŒ‰é’®ï¼Œå°†æ­¤é¡¹ç›®å¤åˆ»åˆ°ä½ è‡ªå·±çš„ GitHub è´¦æˆ·ã€‚

2.  **ç™»å½• Cloudflare**: æ‰“å¼€ [Cloudflare Dashboard](https://dash.cloudflare.com/)ã€‚

3.  **åˆ›å»º Worker**:
    *   åœ¨å·¦ä¾§å¯¼èˆªæ ä¸­ï¼Œè¿›å…¥ `Workers & Pages`ã€‚
    *   ç‚¹å‡» `åˆ›å»ºåº”ç”¨ç¨‹åº` -> `è¿æ¥åˆ° Git`ã€‚
    *   é€‰æ‹©ä½ åˆšåˆš Fork çš„ä»“åº“ã€‚
    *   åœ¨â€œæ„å»ºå’Œéƒ¨ç½²â€è®¾ç½®ä¸­ï¼ŒCloudflare é€šå¸¸ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°è¿™æ˜¯ä¸€ä¸ª Worker é¡¹ç›®ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚
    *   ç‚¹å‡» `ä¿å­˜å¹¶éƒ¨ç½²`ã€‚

## ğŸ”‘ API å¯†é’¥ç®¡ç†

éƒ¨ç½²å®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡è®¿é—®ä½ çš„ Worker URL æ¥ç®¡ç† API å¯†é’¥ã€‚

*   **è®¿é—®ç®¡ç†é¢æ¿**: åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ä½ çš„ Worker URL (ä¾‹å¦‚ `https://gemini-balance-do.your-worker.workers.dev`)ã€‚
*   **æ‰¹é‡æ·»åŠ å¯†é’¥**: åœ¨æ–‡æœ¬æ¡†ä¸­è¾“å…¥ä½ çš„ Gemini API å¯†é’¥ï¼Œæ¯è¡Œä¸€ä¸ªï¼Œç„¶åç‚¹å‡»â€œæ·»åŠ å¯†é’¥â€ã€‚
*   **æŸ¥çœ‹å’Œåˆ·æ–°**: åœ¨å³ä¾§é¢æ¿å¯ä»¥æŸ¥çœ‹å·²å­˜å‚¨çš„å¯†é’¥ï¼Œå¹¶å¯ä»¥ç‚¹å‡»â€œåˆ·æ–°â€æŒ‰é’®æ›´æ–°åˆ—è¡¨ã€‚

## ğŸ’» API ç”¨æ³•

### OpenAI å…¼å®¹ç«¯ç‚¹

ä½ å¯ä»¥å°†ä»»ä½•å…¼å®¹ OpenAI çš„å®¢æˆ·ç«¯çš„åŸºç¡€ URL æŒ‡å‘ä½ çš„ Worker URLã€‚

*   **æ¨¡å‹åˆ—è¡¨**: `GET /v1/models`
*   **èŠå¤©è¡¥å…¨**: `POST /v1/chat/completions`
*   **æ–‡æœ¬åµŒå…¥**: `POST /v1/embeddings`

**ç¤ºä¾‹ (ä½¿ç”¨ cURL):**
```bash
curl -X POST https://<ä½ çš„Workeråœ°å€>/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-1.5-flash",
    "messages": [{"role": "user", "content": "ä½ å¥½ï¼"}]
  }'
```

### Gemini åŸç”Ÿä»£ç†

é¡¹ç›®ä¹Ÿä¼šå°†å…¶ä»–æ‰€æœ‰è·¯å¾„çš„è¯·æ±‚ç›´æ¥ä»£ç†åˆ° Gemini APIã€‚

**ç¤ºä¾‹ (ä½¿ç”¨ cURL):**
```bash
curl -X POST https://<ä½ çš„Workeråœ°å€>/v1beta/models/gemini-1.5-flash:generateContent \
  -H "Content-Type: application/json" \
  -d '{
    "contents": [{"parts":[{"text": "ä½ å¥½"}]}]
  }'
```

### ç®¡ç† API

*   `GET /api/keys`: è·å–æ‰€æœ‰å·²å­˜å‚¨çš„ API å¯†é’¥ã€‚
*   `POST /api/keys`: æ‰¹é‡æ·»åŠ  API å¯†é’¥ã€‚è¯·æ±‚ä½“ä¸º `{"keys": ["key1", "key2"]}`ã€‚
*   `GET /api/keys/check`: æ£€æŸ¥æ‰€æœ‰å¯†é’¥çš„æœ‰æ•ˆæ€§ï¼Œå¹¶è‡ªåŠ¨ç§»é™¤å¤±æ•ˆçš„å¯†é’¥ã€‚
